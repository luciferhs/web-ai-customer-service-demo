{"ast":null,"code":"var _jsxFileName = \"/mnt/d/CascadeProjects/2048/frontend/src/components/ChatWidget/ChatWidget.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from 'react';\nimport './ChatWidget.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ChatWidget = () => {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [isOpen, setIsOpen] = useState(false);\n  const [ws, setWs] = useState(null);\n  const messagesEndRef = useRef(null);\n  useEffect(() => {\n    if (isOpen && !ws) {\n      const websocket = new WebSocket('ws://localhost:8000/ws/chat');\n      websocket.onopen = () => {\n        console.log('Connected to chat server');\n        // 添加欢迎消息\n        setMessages(prev => [...prev, {\n          text: \"您好！我是AI客服助手，请问有什么可以帮您？\",\n          isUser: false\n        }]);\n      };\n      websocket.onmessage = event => {\n        const response = JSON.parse(event.data);\n        setMessages(prev => [...prev, {\n          text: response.message,\n          isUser: false\n        }]);\n      };\n      websocket.onerror = error => {\n        console.error('WebSocket error:', error);\n        setMessages(prev => [...prev, {\n          text: \"连接出现问题，请刷新页面重试。\",\n          isUser: false\n        }]);\n      };\n      setWs(websocket);\n    }\n    return () => {\n      if (ws) {\n        ws.close();\n      }\n    };\n  }, [isOpen]);\n  const scrollToBottom = () => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  };\n  useEffect(scrollToBottom, [messages]);\n  const handleSubmit = e => {\n    e.preventDefault();\n    if (!input.trim()) return;\n\n    // 添加用户消息\n    setMessages(prev => [...prev, {\n      text: input,\n      isUser: true\n    }]);\n\n    // 发送消息到服务器\n    if (ws && ws.readyState === WebSocket.OPEN) {\n      ws.send(input);\n      setInput('');\n    } else {\n      setMessages(prev => [...prev, {\n        text: \"连接已断开，请刷新页面重试。\",\n        isUser: false\n      }]);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat-widget\",\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"chat-toggle\",\n      onClick: () => setIsOpen(!isOpen),\n      children: isOpen ? '关闭客服' : '在线客服'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 13\n    }, this), isOpen && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-header\",\n        children: /*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"AI\\u5BA2\\u670D\\u52A9\\u624B\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"messages-container\",\n        children: [messages.map((msg, idx) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `message ${msg.isUser ? 'user' : 'bot'}`,\n          children: msg.text\n        }, idx, false, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 29\n        }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: messagesEndRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit,\n        className: \"input-form\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          value: input,\n          onChange: e => setInput(e.target.value),\n          placeholder: \"\\u8BF7\\u8F93\\u5165\\u60A8\\u7684\\u95EE\\u9898...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          children: \"\\u53D1\\u9001\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 79,\n    columnNumber: 9\n  }, this);\n};\n_s(ChatWidget, \"TOUONqCmw24XjJ4E/cwaWjMq+yY=\");\n_c = ChatWidget;\nexport default ChatWidget;\nvar _c;\n$RefreshReg$(_c, \"ChatWidget\");","map":{"version":3,"names":["React","useState","useRef","useEffect","jsxDEV","_jsxDEV","ChatWidget","_s","messages","setMessages","input","setInput","isOpen","setIsOpen","ws","setWs","messagesEndRef","websocket","WebSocket","onopen","console","log","prev","text","isUser","onmessage","event","response","JSON","parse","data","message","onerror","error","close","scrollToBottom","_messagesEndRef$curre","current","scrollIntoView","behavior","handleSubmit","e","preventDefault","trim","readyState","OPEN","send","className","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","map","msg","idx","ref","onSubmit","type","value","onChange","target","placeholder","_c","$RefreshReg$"],"sources":["/mnt/d/CascadeProjects/2048/frontend/src/components/ChatWidget/ChatWidget.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport './ChatWidget.css';\n\nconst ChatWidget = () => {\n    const [messages, setMessages] = useState([]);\n    const [input, setInput] = useState('');\n    const [isOpen, setIsOpen] = useState(false);\n    const [ws, setWs] = useState(null);\n    const messagesEndRef = useRef(null);\n\n    useEffect(() => {\n        if (isOpen && !ws) {\n            const websocket = new WebSocket('ws://localhost:8000/ws/chat');\n            \n            websocket.onopen = () => {\n                console.log('Connected to chat server');\n                // 添加欢迎消息\n                setMessages(prev => [...prev, {\n                    text: \"您好！我是AI客服助手，请问有什么可以帮您？\",\n                    isUser: false\n                }]);\n            };\n            \n            websocket.onmessage = (event) => {\n                const response = JSON.parse(event.data);\n                setMessages(prev => [...prev, {\n                    text: response.message,\n                    isUser: false\n                }]);\n            };\n            \n            websocket.onerror = (error) => {\n                console.error('WebSocket error:', error);\n                setMessages(prev => [...prev, {\n                    text: \"连接出现问题，请刷新页面重试。\",\n                    isUser: false\n                }]);\n            };\n            \n            setWs(websocket);\n        }\n        \n        return () => {\n            if (ws) {\n                ws.close();\n            }\n        };\n    }, [isOpen]);\n\n    const scrollToBottom = () => {\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n    };\n\n    useEffect(scrollToBottom, [messages]);\n\n    const handleSubmit = (e) => {\n        e.preventDefault();\n        if (!input.trim()) return;\n\n        // 添加用户消息\n        setMessages(prev => [...prev, {\n            text: input,\n            isUser: true\n        }]);\n\n        // 发送消息到服务器\n        if (ws && ws.readyState === WebSocket.OPEN) {\n            ws.send(input);\n            setInput('');\n        } else {\n            setMessages(prev => [...prev, {\n                text: \"连接已断开，请刷新页面重试。\",\n                isUser: false\n            }]);\n        }\n    };\n\n    return (\n        <div className=\"chat-widget\">\n            <button \n                className=\"chat-toggle\"\n                onClick={() => setIsOpen(!isOpen)}\n            >\n                {isOpen ? '关闭客服' : '在线客服'}\n            </button>\n            \n            {isOpen && (\n                <div className=\"chat-container\">\n                    <div className=\"chat-header\">\n                        <h3>AI客服助手</h3>\n                    </div>\n                    \n                    <div className=\"messages-container\">\n                        {messages.map((msg, idx) => (\n                            <div \n                                key={idx} \n                                className={`message ${msg.isUser ? 'user' : 'bot'}`}\n                            >\n                                {msg.text}\n                            </div>\n                        ))}\n                        <div ref={messagesEndRef} />\n                    </div>\n                    \n                    <form onSubmit={handleSubmit} className=\"input-form\">\n                        <input\n                            type=\"text\"\n                            value={input}\n                            onChange={(e) => setInput(e.target.value)}\n                            placeholder=\"请输入您的问题...\"\n                        />\n                        <button type=\"submit\">发送</button>\n                    </form>\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default ChatWidget;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}